import std/unittest, necsuspd/lightning, necsuspd/stubs/graphics, vmath

suite "Drawing lightning":
  test "draws a lightning bolt":
    let img = newImage("primary", 80, 40, kColorBlack)
    img.setBitmapMask(newImage("mask", img.width, img.height, kColorWhite))

    img.drawLightning(
      7, ivec2(3, 3), ivec2(img.width.int32 - 3, img.height.int32 - 3), 30
    )

    check img == [
      "________________________________________________________________________________",
      "________________________________________________________________________________",
      "__XXXXX_________________________________________________________________________",
      "__XXXXXXXXXXX___________________________________________________________________",
      "__XXXXXXXXXXXXXXXXX_____________________________________________________________",
      "___XXXXXXXXXXXXXXXXXXXXXX_______________________________________________________",
      "_____XXXXXXXXXXXXXXXXXXXXXXXXXX_________________________________________________",
      "______XXXXXX_____XXXXXXXXXXXXXXXXXXXX___________________________________________",
      "_______XXXXXX__________XXXXXXXXXXXXXXXXXXXX_____________________________________",
      "_________XXXXXX______________XXXXXXXXXXXXXXXXX__________________________________",
      "__________XXXXXX___________________XXXXXXXXXXXX_________________________________",
      "___________XXXXXXX_______________________XXXXXXXX_______________________________",
      "_____________XXXXXX________________________XXXXXXX______________________________",
      "______________XXXXXX_______________________X_XXXXXX_____________________________",
      "________________XXXXXX_____________________X___XXXXX____________________________",
      "_________________XXXXXX____________________X____XXXXX___________________________",
      "__________________XXXXXXX_________________X______XXXXXX_________________________",
      "____________________XXXXXX________________X_______XXXXXX________________________",
      "_____________________XXXXXX_______________X________XXXXXX_______________________",
      "_______________________XXXXXX____________X___________XXXXX______________________",
      "________________________XXXXXX___________X___XXX______XXXXXX____________________",
      "_________________________XXXXXX__________X___XXX_______XXXXXX___________________",
      "___________________________XXXXXX________X__XXXX________XXXXXX__________________",
      "____________________________XXXXXX______X_XX_XXX__________XXXXX_________________",
      "_____________________________XXXXX______XX___XXXX__________XXXXX________________",
      "_______________________________XXXXX_________XXXX___________XXXXXX______________",
      "____________________________________XX________XXX____________XXXXXX_____________",
      "______________________________________XXX_____XXX_____________XXXXXX____________",
      "_________________________________________XX___XXX_______________XXXXX___________",
      "___________________________________________XX_XXX________________XXXXXX_________",
      "_____________________________________________XXXXX________________XXXXXX________",
      "______________________________________________XXXXXXXXXXXXX________XXXXXX_______",
      "_______________________________________________XXX_________XXXXXXXXXXXXXXX______",
      "_______________________________________________XXX____________________XXXXX_____",
      "_______________________________________________XXX_____________________XXXXXX___",
      "________________________________________________________________________XXXXXX__",
      "_________________________________________________________________________XXXXXX_",
      "___________________________________________________________________________XXXX_",
      "____________________________________________________________________________XXX_",
      "________________________________________________________________________________",
    ]
