import std/unittest, necsuspd/lightning, necsuspd/stubs/graphics, vmath

suite "Drawing lightning":
  test "draws a lightning bolt":
    let img = newImage("primary", 80, 40, kColorBlack)
    img.setBitmapMask(newImage("mask", img.width, img.height, kColorWhite))

    img.drawLightning(
      2, ivec2(3, 3), ivec2(img.width.int32 - 3, img.height.int32 - 3), 30
    )

    check img == [
      "____________XX__________________________________________________________________",
      "_________XXX__X_________________________________________________________________",
      "__XXXXXXX_____X_________________________________________________________________",
      "__XXXXXXXXXXXXXX________________________________________________________________",
      "__XXXXXXX______X________________________________________________________________",
      "___XXXXXXXXXX___X_______________________________________________________________",
      "_____XXXXXX__XXXX_______________________________________________________________",
      "______XXXXXXX___XXXX____________________________________________________________",
      "________XXXXXXX__X__XX__________________________________________________________",
      "_________XXXXXXX_XX___XXX_______________________________________________________",
      "___________XXXXXXXX______XX_____________________________________________________",
      "_____________XXXXXXXXX_____XXX__________________________________________________",
      "______________XXXXXXX_XXXX____XX________________________________________________",
      "________________XXXXXX____XXXXXXXXXXXXXX________________________________________",
      "_________________XXXXXXX_______XXXXX____X_______________________________________",
      "___________________XXXXXX___________XXXXXX______________________________________",
      "____________________XXXXXXX_______________XXXXX_________________________________",
      "____________________X_XXXXXX______________XXX__XXXXX____________________________",
      "____________________X__XXXXXXX_____________X_X___XX_XXX_________________________",
      "_____________________X___XXXXXXX____________X_XXX___X_______XX__________________",
      "_____________________X____XXXXXXX____________XXX_____X__XXXX____________________",
      "____________________________XXXXXXX___________X_X___XXXX________________________",
      "______________________________XXXXXX___________XXXXX__X_________________________",
      "_______________________________XXXXXXX______XXXXX_X____X________________________",
      "_________________________________XXXXXX_XXXX_____X_X____X_______________________",
      "__________________________________XXXXXX__________XXXX___XX_____________________",
      "____________________________________XXXXXX__________X_X____X____________________",
      "_____________________________________XXXXXX__________X_X____X___________________",
      "______________________________________XXXXXX__________X_X____XX___X_____________",
      "________________________________________XXXXX__________X_X_____X_X______________",
      "_________________________________________XXXXXX_________X_X____XX_______________",
      "__________________________________________XXXXXX_________X_X__X__XX_____________",
      "___________________________________________XXXXXX_________XXXX_____X___XX_______",
      "_____________________________________________XXXXX_______XXXXXX_____XXX_________",
      "______________________________________________XXXXX_____XXXXXXXX_XXX_XX_________",
      "_______________________________________________XXXXXX__XXXXXXXXXX______X________",
      "________________________________________________XXXXXXXXXXXXXXXXXX____XXXXXXXXX_",
      "_________________________________________________XXXXXXXXX___XXXXXXXXXXXXXXXXXX_",
      "___________________________________________________XXXXXX_____XXXXXXXXXXXXXXXXX_",
      "____________________________________________________XXX________XXXXXXXXX________"
    ]
